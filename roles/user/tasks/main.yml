---
- hosts: all
  user: vagrant
  vars:
    createuser: 'steve'
  tasks:
  - name: Setup | create user
    command: useradd -m {{ createuser }} creates=/home/{{ createuser }}
    sudo: true
 
  - name: Setup | set user password
    shell: usermod -p $(echo '{{ steve_password }}' | openssl passwd -1 -stdin) {{ createuser }}
    sudo: true
 
  - name: Setup | authorized key upload
    authorized_key: user={{ createuser }}
      key="{{ steve_key }}"
      path='/home/{{ createuser }}/.ssh/authorized_keys'
      manage_dir=no
    sudo: true
 
  - name: Sudoers | update sudoers file and validate
    lineinfile: "dest=/etc/sudoers
      insertafter=EOF
      line='{{ createuser }} ALL=(ALL) NOPASSWD: ALL'
      regexp='{{ createuser }} ALL=(ALL) NOPASSWD: ALL'
      state=present"
    sudo: true

  - name: add dotfiles to user name
    git: repo=https://github.com/steviedons/dotfiles.git dest=/home/steve/dotfiles 

  - name: add screenfetch script
    copy: src=screenfetch-dev dest=/usr/local/bin mode="u+rx,g+rx,o+rx"

  - name: run the dotfiles setup script
    command: /home/steve/dotfiles/dotfile_update.sh
        sudo: yes
            sudo_user: steve

